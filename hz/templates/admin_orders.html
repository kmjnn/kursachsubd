{% extends "base.html" %}

{% block title %}Управление заказами{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Управление заказами</h2>
    
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID заказа</th>
                <th>Клиент</th>
                <th>Курьер</th>
                <th>Стоимость</th>
                <th>Адрес</th>
                <th>Статус</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for data in orders_data %}
            {% set order = data.order %}
            <tr>
                <td>{{ order.order_id }}</td>
                <td>
                    {{ data.client.username if data.client else 'Неизвестен' }}
                </td>
                <td>
                    {% if data.courier %}
                        {{ data.courier.username }}
                    {% else %}
                        <form action="/admin/order/{{ order.order_id }}/assign" method="POST">
                            <select name="courier_id" class="form-select form-select-sm">
                                <option value="">-- Отменить назначение --</option>
                                {% for courier in available_couriers %}
                                <option value="{{ courier.id }}">{{ courier.username }}</option>
                                {% endfor %}
                            </select>
    <button type="submit" class="btn btn-sm btn-primary mt-1">Сохранить</button>
</form>
                    {% endif %}
                </td>
                <td>{{ order.order_cost }} руб.</td>
                <td>{{ order.delivery_address }}</td>
                <td>
                    {% if data.courier %}
                        Назначен
                    {% else %}
                        Ожидает курьера
                    {% endif %}
                </td>
                <td>
                    <a href="/admin/orders/{{ order.order_id }}" class="btn btn-sm btn-info">Подробности</a>
                    <form action="/admin/orders/delete/{{ order.order_id }}" method="POST" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Вы уверены?')">Удалить</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}